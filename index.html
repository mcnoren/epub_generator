function insertImageToEditor(input) {
        if(!input.files[0]) return;
        const file = input.files[0];
        const filename = "img_" + Date.now() + "." + file.name.split('.').pop();
        book.assets[filename] = file;
        const url = URL.createObjectURL(file);
        
        const img = document.createElement('img');
        img.src = url;
        img.setAttribute('data-filename', filename);
        img.setAttribute('alt', '');
        
        // Default: 30% width, Inline-Block (Allows multiple per row)
        img.style.width = "30%";
        img.style.display = "inline-block";
        img.style.margin = "5px"; // spacing
        
        // --- FIX STARTS HERE ---
        const editor = document.getElementById('editor');
        const sel = document.getSelection();
        
        // Check if a selection exists AND if it is inside the editor
        if (sel.rangeCount > 0 && editor.contains(sel.getRangeAt(0).commonAncestorContainer)) {
            const range = sel.getRangeAt(0);
            range.insertNode(img);
            range.collapse(false);
        } else {
            // Fallback: Just append to the end of the editor
            editor.appendChild(img);
        }
        // --- FIX ENDS HERE ---
        
        saveCurrent();
        input.value = "";
    }
